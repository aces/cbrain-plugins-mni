<!doctype html>
<html lang="en">  
  <head>  
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">  
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <title>BrainBrowser:Surface Viewer</title>  
  </head>  
  <body>  

    <div id="controls">
      
      <div id="surface_choice" class="box full_box">
	<h4>Files</h4>
	
	<form id="datafile-form" method="POST"  action="/upload/minc" enctype="multipart/form-data">

	 <%- 
	    if params[:collection_file]
	    surface_dir = (Pathname.new(params[:collection_file]).parent.parent + "surfaces").to_s.sub(/^#{@userfile.name}\/+/, "")
	    else
	    surface_dir = "surface"
	    end 
	-%>

	 Surface File: 
	 <select name="surface" class="surface">
	   <%= options_for_select   @userfile.list_files(surface_dir).map(&:name).reject { |n| n =~ /\.dat$/ } %>
         </select>
	 <%- 
	    if params[:collection_file]
	    thickness_dir = (Pathname.new(params[:collection_file]).parent.parent + "thickness").to_s.sub(/^#{@userfile.name}\/+/, "")
	    else
	    thickness_dir = "thickness"
	    end 
	-%>

	 Thickness File: 
	 <select name="thickness" class="thickness">
	   <%= options_for_select   @userfile.list_files(thickness_dir).map(&:name).reject { |n| n =~ /\.dat$/ } %>
	</select>

	Color Bar: <input type="file" name="spectrum" id="spectrum"><br />
	</form>
      </div>
      <div class="box full_box" id="shapes-box">
	<div id="shapes">
	  
	</div>
	<span id="clearshapes" class="button">Clear Shapes</span>
      </div>
      <div class="combo_box full_box">
	<div id="views" class="box half_box" >
	  <h4>Views</h4>
	  <div id="hem_views_1" class="half_box">
	    <input id="left_hem_visible" class="view_button" type="checkbox" checked="true">Left 
	    <br />
	    <input id="hem_superior" class="view_button" type="radio" name="hem_view" value="superior" checked="true">Superior
	    
	    <br />
	    <input id="hem_medial" class="view_button" type="radio" name="hem_view" value="medial">Medial
	    
	    <br />
	    <input id="hem_anterior" class="view_button" type="radio" name="hem_view" value="anterior">Anterior
	    
	  </div>
	  <div id="hem_views_2" class="half_box">
	    <input id="right_hem_visible" class="view_button" type="checkbox" checked="true">Right<br />
	    <input id="hem_inferior" class="view_button" type="radio" name="hem_view" value="inferior">Inferior	     
	    <br />
	    <input id="hem_lateral" class="view_button" type="radio" name="hem_view" value="lateral">Lateral
	    <br />
	    <input id="hem_posterior" class="view_button" type="radio" name="hem_view" value="posterior">Posterior
	  </div>
	  <p>
	    <a class="button" id="resetview">Reset View</a>
	    <input type="checkbox" class="button" id="autorotate"><label for="autorotate">Autorotate</label>
	    <input type="checkbox" class="button" id="meshmode"><label for="meshmode">Mesh Mode</label>
	  </p>
	  
	</div>

	<div id="coordinates" class="box half_box">
	  <h4>Coordinates</h4>
	  <p>
	    <input id="x-coord" type="text" size="5">&nbsp<span class="button" id="x-coord-flip">X</span><br />
	    <input id="y-coord" type="text" size="5"> Y<br />
	    <input id="z-coord" type="text" size="5"> Z<br />
	    <input id="v-coord" type="text" size="5"> Index<br />
	    <input id="value-coord" type="text" size="5"> Value
	  </p>
	</div>
      </div>
      
      <div id="data_range" class="box full_box">
	<h4>Thresholding</h4>
	<div id="data-range">
	  Min: <input class="range-box" id="data-range-min" type="text" name="range_min" size="5" ><br />
	    <div id="range-slider" class="slider"></div>
	  Max: <input class="range-box" id="data-range-max" type="text" name="range_max" size="5" >
	  <input type="checkbox" class="button" id="fix_range"><label for="fix_range">Fix Range</label>
	  <input type="checkbox" class="button" id="clamp_range" checked="true"><label for="clamp_range">Clamp range</label>
	  <input type="checkbox" class="button" id="flip_range"><label for="flip_range">Flip Colors</label>
	</div>
      </div>
      <span id="openImage" class="button">Get Screenshot</span>      
      <a class="button" href="/macacc.html">MACACC Dataset</a>
      <a class="button" href="/about">About</a><br />
      Back Ground Color:
      <select id="clearColor"> 
	<option value="default">Default(Gray)</option>
	<option value="white">White</option>
	<option value="black">Black</option>
	<option value="pink">HOT PINK!</option>
      </select>
	   
</div>

    <!-- The webgl window and loading messages if any -->
    <div Id="view-window">
      <center><span id="age_series"></span></center>
      <div id="o3d"></div>  
      <div id="loading"></div>
    </div>

    <!-- all the scripts and css -->
    <link type="text/css" href="/stylesheets/ui-darkness/jquery-ui-1.8.10.custom.css" rel="Stylesheet" />
    <link type="text/css" href="/stylesheets/brainbrowser.css" rel="Stylesheet" />
    <%= javascript_include_tag "jquery", "jquery-ui" %>
    <script type="text/javascript" src="/javascripts/o3d-webgl/base.js"></script>
    <script type="text/javascript" src="/javascripts/o3djs/base.js"></script> 
    <script type="text/javascript" src="/javascripts/surfview-combined.min.js"></script>
    <script type="text/javascript">
    $(function() {
      document.getElementById("view-window").onselectstart = function() {
      return false;
    };
      
      document.getElementById("view-window").onmousedown = function() {
        return false;
      };
      
      jQuery(".button").button();
      var surfview = new SurfView();
      
      jQuery("#objfile").change(function() {
        surfview.brainbrowser.loadObjFromFile(document.getElementById("objfile"));
      });
      
      jQuery("#datafile").change(function() {
        surfview.brainbrowser.loadDataFromFile(document.getElementById("datafile"));
      });

      jQuery("#spectrum").change(function() {
        surfview.brainbrowser.loadSpectrumFromFile(document.getElementById("spectrum"));
      });



    });
    </script>
  </body>  
</html>  
