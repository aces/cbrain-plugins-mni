<!-- 
   Partial to be rendered for DrmaaCivetCombiner
-->
<% title 'CivetCombiner Parameters' %>
<div class = "generalcontent">


<h2>New CivetCombiner task</h2>
<div class = "generalbox">

<%
     form_tag( '/tasks/create' ) do 
-%>

<!-- 
  Make sure parameters 'task' and 'file_ids' are always set to something,
  as they are required internally.
-->

<%= hidden_field_tag :task,        'DrmaaCivetCombiner' %>
<%= hidden_field_tag :bourreau_id, params[:bourreau_id] %>
<% params[:file_ids].each do |id| %>
<%= hidden_field_tag 'file_ids[]',  id %>
<% end %>

<strong>
Name of the combined Study:
</strong><BR>
<%= text_field_tag :civet_study_name, params[:civet_study_name] %>
<br>

<table>
  <tr>
    <th>CivetCollection Names To Be Merged</th>
  </tr>
<% params[:file_ids].each do |id| %>
  <tr>
    <% u = Userfile.find(id) %>
    <% if u.is_a?(CivetCollection) || u.is_a?(CivetStudy) %>
      <td>OK: <%= h(u.class.to_s) %> <%= h(u.name) %> <%= hidden_field_tag 'civet_collection_ids[]', id %></td>
    <% else %>
      <td>Error: <%= h(u.name) %> is NOT a Civet Collection or Study.</td>
    <% end %>
  </tr>
<% end %>
</table>

Save results to:
<%= select_tag "data_provider_id", options_for_select(data_providers.collect{ |p| [ p.name, p.id ] }, current_user.user_preference.data_provider_id) %>
<br><br>

After the Study is successfully created, <strong>destroy permanently</strong>
the CivetCollections used? <%= check_box_tag( :destroy_sources, 'YeS') %>
<br><br>

<%= submit_tag 'Start CivetCombiner' %>

<% end %>

</div> <!-- generalbox -->
</div> <!-- generalcontent -->